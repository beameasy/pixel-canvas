import{useCallback as t}from"react";import{PrivyErrorCode as e}from"../errors.mjs";import{useCaptcha as r,CaptchaError as s}from"./captcha-context.mjs";import{usePrivyInternal as o}from"./internal-context.mjs";import"ofetch";import"react/jsx-runtime";import"./index.mjs";import"../utils/index.mjs";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../utils/eth/getPublicClient.mjs";import"viem";const i=i=>{let a=r(),{initLoginWithPasskey:n,loginWithPasskey:c,passkeyAuthState:m,setPasskeyAuthState:l}=o();return{loginWithPasskey:t((async t=>{try{let r;if(a.enabled&&"error"===a.status)throw new s(a.error,null,e.CAPTCHA_FAILURE);a.enabled&&"success"!==a.status&&(a.execute(),r=await a.waitForResult()),await n({captchaToken:r,withPrivyUi:!1});let{user:o,isNewUser:m,wasAlreadyAuthenticated:l,loginAccount:u}=await c(t);i?.onComplete?.({user:o,isNewUser:m,wasAlreadyAuthenticated:l,loginMethod:"passkey",loginAccount:u})}catch(t){throw l({status:"error",error:t}),i?.onError?.(t.privyErrorCode||e.UNKNOWN_AUTH_ERROR),t}}),[c,a.status]),state:m}};export{i as useLoginWithPasskey};
