import{jsx as i}from"react/jsx-runtime";import{useContext as t,useState as e,useEffect as n,createContext as o}from"react";import{useAppConfig as r}from"../configuration/context.mjs";import{PrivyClientError as s}from"../errors.mjs";import{getEmbeddedConnectedWallet as a}from"../lib/getEmbeddedConnectedWallet.mjs";import{useSmartWalletsUIWrapper as c,getSmartWalletClient as m,useSmartWalletsWrapper as l}from"../lib/smart-wallets.mjs";import{notImplemented as p}from"./index.mjs";import{usePrivyInternal as h}from"./internal-context.mjs";import{usePrivyContext as d}from"./privy-context.mjs";import{useWallets as f}from"./useWallets.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../constants.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"ofetch";import"viem";import"../client/user.mjs";import"viem/utils";import"./modal-context.mjs";import"../components/PrefetchedImage.mjs";import"../screens/index.mjs";import"./useSmartWalletChain.mjs";import"../utils/eth/getPublicClient.mjs";import"../lib/smart-wallets-shared.mjs";import"permissionless";import"permissionless/accounts";import"permissionless/clients/pimlico";import"viem/account-abstraction";import"@privy-io/js-sdk-core";let g=/*#__PURE__*/o({client:void 0,getClientForChain:p});const j=({config:t,children:e})=>/*#__PURE__*/i(w,{children:/*#__PURE__*/i(v,{config:t,children:/*#__PURE__*/i(W,{children:e})})}),u=()=>{let{client:i,getClientForChain:e}=t(g);return{client:i,getClientForChain:e}};let C=/*#__PURE__*/o({config:void 0}),y=()=>{let{config:i}=t(C);return{config:i}},w=({children:t})=>{let[o,r]=e(void 0),{client:s}=h();return n((()=>{!o&&s&&(async()=>{try{if(!s)return void console.warn("No client found");let i=await s.getSmartWalletsConfig();r(i)}catch(i){console.warn("Error generating smart wallet config: ",i)}})()}),[!!s]),/*#__PURE__*/i(C.Provider,{value:{config:o},children:t})},v=({config:t,children:o})=>{let{config:l}=y(),{appId:p}=h(),{chains:g,defaultChain:j,rpcConfig:u}=r(),{wallets:C}=f(),{user:w}=d(),[v,W]=e(),{wrapSmartAccountClientWithUIs:x}=c(),F=a(C);n((()=>{(async()=>{if(!l?.enabled)return;let i=l.configuredNetworks.find((i=>i.chainId===`eip155:${j.id}`))?j:g.find((i=>l.configuredNetworks.map((i=>i.chainId)).includes(`eip155:${i.id}`)));if(!i)throw new s("Could not find smart wallets chain configurations for any Privy client configured chains. Please configure smart wallets for your chains in the Privy dashboard.");W(await m({chain:i,privyAppId:p,paymasterContext:t?.paymasterContext,rpcConfig:u,embeddedWallet:F,user:w,smartWalletsConfig:l}))})()}),[!!l?.enabled,!!w?.smartWallet,!!F]);/*#__PURE__*/return i(b.Provider,{value:{client:v,config:t,getClientForChain:async({id:i})=>{let e=a(C),n=await m({chain:g.find((t=>t.id===i)),privyAppId:p,paymasterContext:t?.paymasterContext,rpcConfig:u,embeddedWallet:e,user:w,smartWalletsConfig:l});if(!n)throw new s(`Failed to create smart wallet client for chain id: ${i}`);return x(n)}},children:o})},b=/*#__PURE__*/o({client:void 0,config:void 0,getClientForChain:p}),W=({children:e})=>{let{client:o,config:r,getClientForChain:s}=(()=>{let{client:i,config:e,getClientForChain:n}=t(b);return{client:i,config:e,getClientForChain:n}})(),{config:a}=y(),{wrapSmartAccountClient:c}=l({clientConfig:r,smartWalletsConfig:a}),{user:m}=d(),{generateSiweMessageForSmartWallet:p,linkSmartWallet:f,hideWalletUIs:j}=h();return n((()=>{(async()=>{if(o&&m&&!m?.smartWallet&&a?.enabled)try{let i=await p({address:o.account.address,chainId:`eip155:${o.chain.id}`});j.current=!0;let t=await o.signMessage({message:i});await f({signature:t,message:i,smartWalletType:a.smartWalletType})}catch(i){console.error("Error creating smart wallet:",i)}finally{j.current=!1}})()}),[!!o,!!m?.smartWallet,!!a?.enabled]),/*#__PURE__*/i(g.Provider,{value:{client:m?.smartWallet&&o?c(o):void 0,getClientForChain:s},children:e})};export{j as SmartWalletsProvider,u as useSmartWallets};
