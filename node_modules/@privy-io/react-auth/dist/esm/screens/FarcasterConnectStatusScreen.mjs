import{jsxs as e,Fragment as o,jsx as t}from"react/jsx-runtime";import{ModalScreen as r}from"./index.mjs";import{useState as i,useRef as n,useEffect as s}from"react";import{isMobile as a,isIOS as c}from"react-device-detect";import{styled as m}from"styled-components";import{PrimaryButton as l}from"../components/Button.mjs";import{CopytoClipboardButton as d}from"../components/CopyToClipboard.mjs";import{RefactorSpacerTop as p,FixedGappedContainer as h,CenteredItem as u,CenteredItemWithPadding as j}from"../components/Layouts.mjs";import{ConnectionLoader as f,Loader as E}from"../components/Loader.mjs";import{ModalFooter as g}from"../components/ModalFooter.mjs";import{ModalHeader as C}from"../components/ModalHeader.mjs";import{OpenLinkButton as y}from"../components/OpenLink.mjs";import{QrCode as v}from"../components/QrCode.mjs";import T from"../components/layout/StackedContainer.mjs";import{DEFAULT_SUCCESS_SCREEN_DURATION_MS as S}from"../constants.mjs";import{PrivyErrorCode as _,PrivyUserLimitReachedError as b}from"../errors.mjs";import{usePrivyInternal as A}from"../hooks/internal-context.mjs";import{usePrivyModal as N}from"../hooks/modal-context.mjs";import{usePrivyContext as w}from"../hooks/privy-context.mjs";import{shouldProceedtoEmbeddedWalletCreationFlow as I}from"../lib/user/shouldProceedtoEmbeddedWalletCreationFlow.mjs";import{Farcaster as x}from"../svg/farcaster.mjs";import{Title as R,SubTitle as k}from"./MfaScreens/StyledComponents.mjs";import"../svg/checkmark.mjs";import"../svg/copy.mjs";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../hooks/index.mjs";import"qrcode";import"../svg/black-rounded-square.mjs";import"../utils/index.mjs";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../utils/eth/getPublicClient.mjs";import"viem";import"ofetch";import"../components/PrefetchedImage.mjs";import"../lib/user/shouldCreateEmbeddedEthWallet.mjs";import"../client/user.mjs";import"viem/utils";import"../lib/user/shouldCreateEmbeddedSolWallet.mjs";let O="#8a63d2";const L=()=>{let{authenticated:m,logout:L,ready:W,user:U}=w(),{lastScreen:M,navigate:q,navigateBack:H,setModalData:P,app:z}=N(),{getAuthFlow:B,loginWithFarcaster:Q,closePrivyModal:J,createAnalyticsEvent:K}=A(),[V,X]=i(void 0),[Y,G]=i(!1),[Z,$]=i(!1),ee=n([]),oe=B(),te=oe?.meta.connectUri;return s((()=>{let e=Date.now(),o=setInterval((async()=>{let t=await oe.pollForReady.execute(),i=Date.now()-e;if(t){clearInterval(o),G(!0);try{await Q(),$(!0)}catch(e){let o={retryable:!1,message:"Authentication failed"};if(e?.privyErrorCode===_.ALLOWLIST_REJECTED)return void q(r.ALLOWLIST_REJECTION_SCREEN);if(e?.privyErrorCode===_.USER_LIMIT_REACHED)return console.error(new b(e).toString()),void q(r.USER_LIMIT_REACHED_SCREEN);if(e?.privyErrorCode===_.USER_DOES_NOT_EXIST)return void q(r.ACCOUNT_NOT_FOUND_SCREEN);if(e?.privyErrorCode===_.LINKED_TO_ANOTHER_USER)o.detail=e.message??"This account has already been linked to another user.";else{if(e?.privyErrorCode===_.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return P({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,displayName:e.data?.data?.account?.displayName,linkMethod:"farcaster",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress,farcasterEmbeddedAddress:e.data?.data?.otherUser?.farcasterEmbeddedAddress}}),void q(r.LINK_CONFLICT_SCREEN);e?.privyErrorCode===_.INVALID_CREDENTIALS?(o.retryable=!0,o.detail="Something went wrong. Try again."):e?.privyErrorCode===_.TOO_MANY_REQUESTS&&(o.detail="Too many requests. Please wait before trying again.")}X(o)}}else i>12e4&&(clearInterval(o),X({retryable:!0,message:"Authentication failed",detail:"The request timed out. Try again."}))}),2e3);return()=>{clearInterval(o),ee.current.forEach((e=>clearTimeout(e)))}}),[]),s((()=>{if(W&&m&&Z&&U){if(z?.legal.requireUsersAcceptTerms&&!U.hasAcceptedTerms){let e=setTimeout((()=>{q(r.AFFIRMATIVE_CONSENT_SCREEN)}),S);return()=>clearTimeout(e)}Z&&(I(U,z.embeddedWallets)?ee.current.push(setTimeout((()=>{P({createWallet:{onSuccess:()=>{},onFailure:e=>{console.error(e),K({eventName:"embedded_wallet_creation_failure_logout",payload:{error:e,screen:"FarcasterConnectStatusScreen"}}),L()},callAuthOnSuccessOnClose:!0}}),q(r.EMBEDDED_WALLET_ON_ACCOUNT_CREATE_SCREEN)}),S)):ee.current.push(setTimeout((()=>J({shouldCallAuthOnSuccess:!0,isSuccess:!0})),S)))}}),[Z,W,m,U]),/*#__PURE__*/e(o,a||Y?{children:[/*#__PURE__*/t(C,{backFn:M?H:void 0,onClose:J},"header"),/*#__PURE__*/t(p,{}),
/*#__PURE__*/t(o,c?{children:/*#__PURE__*/e(D,{children:[/*#__PURE__*/t(T,{children:/*#__PURE__*/e("div",{children:[/*#__PURE__*/t(f,{success:Z,fail:!!V}),/*#__PURE__*/t(x,{style:{width:"38px",height:"38px"}})]})}),/*#__PURE__*/e(h,{children:[/*#__PURE__*/t(R,{children:V?V.message:"Sign in with Farcaster"}),/*#__PURE__*/t(k,{children:V?V.detail:"To sign in with Farcaster, please open the Warpcast app."})]}),te&&/*#__PURE__*/t(l,{onClick:e=>{e.preventDefault(),window.location.href=te},children:"Open Warpcast app"})]})}:{children:/*#__PURE__*/e(F,{children:[/*#__PURE__*/t(T,{children:/*#__PURE__*/e("div",{children:[/*#__PURE__*/t(f,{success:Z,fail:!!V}),/*#__PURE__*/t(x,{style:{width:"38px",height:"38px"}})]})}),/*#__PURE__*/e(h,{children:[/*#__PURE__*/t(R,{children:V?V.message:"Signing in with Farcaster"}),/*#__PURE__*/t(k,{children:V?V.detail:"This should only take a moment"}),/*#__PURE__*/t(u,{children:te&&a&&/*#__PURE__*/t(y,{text:"Take me to Warpcast",url:te,color:O})})]})]})}),/*#__PURE__*/t(g,{})]}:{children:[/*#__PURE__*/t(C,{backFn:M?H:void 0,onClose:J},"header"),/*#__PURE__*/t(p,{}),/*#__PURE__*/t(F,{children:/*#__PURE__*/e("div",{children:[/*#__PURE__*/t(R,{children:"Sign in with Farcaster"}),/*#__PURE__*/t(k,{children:"Scan with your phone's camera to continue."}),/*#__PURE__*/t(j,{children:te?/*#__PURE__*/t(v,{url:te,size:275,squareLogoElement:x}):/*#__PURE__*/t(E,{})}),/*#__PURE__*/e(u,{children:[/*#__PURE__*/t(k,{children:"Or copy this link and paste it into a phone browser to open the Warpcast app."}),te&&/*#__PURE__*/t(d,{text:te,itemName:"link",color:O})]})]})}),/*#__PURE__*/t(g,{})]})};let F=/*#__PURE__*/m.div.withConfig({displayName:"ConnectContainer",componentId:"sc-d15a94a3-0"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;margin-left:27px;margin-right:27px;gap:24px;"]),D=/*#__PURE__*/m.div.withConfig({displayName:"ConnectContainerButton",componentId:"sc-d15a94a3-1"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;width:100%;"]);export{L as FarcasterConnectStatusScreen};
