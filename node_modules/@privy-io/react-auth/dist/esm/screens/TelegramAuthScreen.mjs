import{jsxs as e,Fragment as t,jsx as o}from"react/jsx-runtime";import{useState as r,useEffect as i}from"react";import{styled as n}from"styled-components";import{getTelegramAuthErrorMessage as s}from"../auth-flows/telegram.mjs";import{SoftCtaButton as a}from"../components/Button.mjs";import{RefactorSpacerTop as m,FixedGappedContainer as c,RefactorSpacerBottom as l}from"../components/Layouts.mjs";import{ConnectionLoader as p}from"../components/Loader.mjs";import{ModalFooter as d}from"../components/ModalFooter.mjs";import{ModalHeader as u}from"../components/ModalHeader.mjs";import h from"../components/layout/StackedContainer.mjs";import{DEFAULT_SUCCESS_SCREEN_DURATION_MS as j}from"../constants.mjs";import{PrivyErrorCode as f,PrivyUserLimitReachedError as g}from"../errors.mjs";import{useCaptcha as E,CaptchaError as y}from"../hooks/captcha-context.mjs";import{usePrivyInternal as C}from"../hooks/internal-context.mjs";import{usePrivyModal as T}from"../hooks/modal-context.mjs";import{usePrivyContext as A}from"../hooks/privy-context.mjs";import{shouldProceedtoEmbeddedWalletCreationFlow as b}from"../lib/user/shouldProceedtoEmbeddedWalletCreationFlow.mjs";import{Telegram as v}from"../svg/telegram.mjs";import{ModalScreen as _}from"./index.mjs";import"../paths.mjs";import"ofetch";import"../hooks/index.mjs";import"../utils/index.mjs";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../utils/eth/getPublicClient.mjs";import"viem";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../components/PrefetchedImage.mjs";import"../lib/user/shouldCreateEmbeddedEthWallet.mjs";import"../client/user.mjs";import"viem/utils";import"../lib/user/shouldCreateEmbeddedSolWallet.mjs";const S=()=>{let{authenticated:n,logout:S,ready:N,user:w}=A(),{app:x,setModalData:I,navigate:L,resetNavigation:O,data:W}=T(),{initLoginWithTelegram:k,loginWithTelegram:D,updateWallets:M,setReadyToTrue:F,closePrivyModal:U,createAnalyticsEvent:H,getAuthMeta:P}=C(),[z,J]=r(!1),[B,Q]=r(void 0),V=E();async function X(){try{let e=await async function(){let e;if(!n){if(V.enabled&&"error"===V.status)throw new y(V.error,null,f.CAPTCHA_FAILURE);return V.enabled&&"success"!==V.status&&(V.execute(),e=await V.waitForResult()),e}}();await D({captchaToken:e}),J(!0),F(!0)}catch(e){if(e?.privyErrorCode===f.ALLOWLIST_REJECTED)return Q(void 0),O(),void L(_.ALLOWLIST_REJECTION_SCREEN);if(e?.privyErrorCode===f.USER_LIMIT_REACHED)return console.error(new g(e).toString()),Q(void 0),O(),void L(_.USER_LIMIT_REACHED_SCREEN);if(e?.privyErrorCode===f.USER_DOES_NOT_EXIST)return Q(void 0),O(),void L(_.ACCOUNT_NOT_FOUND_SCREEN);if(e?.privyErrorCode===f.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return Q(void 0),O(),I({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,telegramAuthResult:P()?.telegramAuthResult,telegramWebAppData:P()?.telegramWebAppData,displayName:e.data?.data?.account?.displayName,linkMethod:"telegram",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void L(_.LINK_CONFLICT_SCREEN);let{retryable:t,detail:o}=s(e);Q({retryable:t,detail:o,message:"Authentication failed"})}}i((()=>{X()}),[]),i((()=>{if(!(N&&n&&z&&w))return;if(x?.legal.requireUsersAcceptTerms&&!w.hasAcceptedTerms){let e=setTimeout((()=>{L(_.AFFIRMATIVE_CONSENT_SCREEN)}),j);return()=>clearTimeout(e)}if(b(w,x.embeddedWallets)){let e=setTimeout((()=>{I({createWallet:{onSuccess:()=>{},onFailure:e=>{console.error(e),H({eventName:"embedded_wallet_creation_failure_logout",payload:{error:e,provider:"telegram",screen:"TelegramAuthScreen"}}),S()},callAuthOnSuccessOnClose:!0}}),L(_.EMBEDDED_WALLET_ON_ACCOUNT_CREATE_SCREEN)}),j);return()=>clearTimeout(e)}M();let e=setTimeout((()=>U({shouldCallAuthOnSuccess:!0,isSuccess:!0})),j);return()=>clearTimeout(e)}),[N,n,z,w]);let q=z?"Successfully connected with Telegram":B?B.message:"Verifying connection to Telegram",K="";return K=z?"Youâ€™re good to go!":B?B.detail:"Just a few moments more",/*#__PURE__*/e(t,{children:[/*#__PURE__*/o(u,{}),/*#__PURE__*/o(m,{}),/*#__PURE__*/e(R,{children:[/*#__PURE__*/o(h,{children:/*#__PURE__*/e("div",{children:[/*#__PURE__*/o(p,{success:z,fail:!!B}),/*#__PURE__*/o(v,{style:{width:"38px",height:"38px"}})]})}),/*#__PURE__*/e(c,{children:[/*#__PURE__*/o("h3",{children:q}),/*#__PURE__*/o("p",{children:K})]}),B&&B?.retryable?/*#__PURE__*/o(a,{onClick:async()=>{try{Q(void 0),W?.telegramAuthModalData?.seamlessAuth||await k(void 0,W?.login?.disableSignup),await X()}catch(e){let{retryable:t,detail:o}=s(e);Q({retryable:t,detail:o,message:"Authentication failed"})}},disabled:!z&&!B?.retryable,children:"Retry"}):null]}),/*#__PURE__*/o(l,{}),/*#__PURE__*/o(d,{})]})};let R=/*#__PURE__*/n.div.withConfig({displayName:"ConnectContainer",componentId:"sc-35bf31dd-0"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;margin-left:27px;margin-right:27px;gap:24px;"]);export{S as TelegramAuthScreen};
