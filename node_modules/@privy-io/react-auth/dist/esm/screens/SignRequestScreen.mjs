import{jsxs as o,Fragment as t,jsx as n}from"react/jsx-runtime";import{useState as i,useEffect as e}from"react";import{styled as r}from"styled-components";import{isHex as s,hexToString as c}from"viem";import{ProviderErrors as m}from"@privy-io/js-sdk-core";import{PrimaryButtonWithoutGray as a,EmbeddedButton as p}from"../components/Button.mjs";import{CopytoClipboardButton as l}from"../components/CopyToClipboard.mjs";import{RefactorSpacerTop as h,RefactorSpacerBottom as d}from"../components/Layouts.mjs";import{BlobbyFooter as j}from"../components/ModalFooter.mjs";import{ModalHeader as u}from"../components/ModalHeader.mjs";import{StyledLogo as g}from"../components/embedded-wallets/StyledLogo.mjs";import{Message as f,DisplayJsonTree as y}from"../components/primitives/JsonTree.mjs";import{Subtitle as x}from"../components/ui/typography/Subtitle.mjs";import{Title as b}from"../components/ui/typography/Title.mjs";import{PrivyProviderRpcError as v,ProviderRpcError as w}from"../connectors/errors.mjs";import{WALLET_PROXY_TIMEOUT as C,DEFAULT_SUCCESS_SCREEN_DURATION_MS as T}from"../constants.mjs";import{usePrivyInternal as S}from"../hooks/internal-context.mjs";import{usePrivyModal as k}from"../hooks/modal-context.mjs";import{usePrivyContext as E}from"../hooks/privy-context.mjs";import{Checkmark as I}from"../svg/checkmark.mjs";import{ModalScreen as A}from"./index.mjs";import"../components/Loader.mjs";import"../svg/copy.mjs";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../hooks/index.mjs";import"../errors.mjs";import"ofetch";import"../components/PrefetchedImage.mjs";let N=o=>{if(!s(o))return o;try{return c(o)}catch{return o}},R=i=>{let{types:e,primaryType:r,...s}=i.typedData;/*#__PURE__*/return o(t,{children:[/*#__PURE__*/n(y,{data:s}),/*#__PURE__*/n(l,{text:(c=i.typedData,JSON.stringify(c,null,2)),itemName:"full payload to clipboard"})," "]});var c};const _=()=>{let{authenticated:r}=E(),{initializeWalletProxy:s,closePrivyModal:c}=S(),{navigate:l,data:y,onUserCloseViaDialogOrKeybindRef:_}=k(),[z,O]=i(!0),[F,H]=i(""),[J,P]=i(),[W,G]=i(null),[Q,$]=i(!1),q=null!==W;e((()=>{r||l(A.LANDING)}),[r]),e((()=>{s(C).then((o=>{O(!1),o||(H("An error has occurred, please try again."),P(new v(new w(F,m.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:B,data:K,confirmAndSign:V,onSuccess:X,onFailure:Y,uiOptions:Z}=y.signMessage,oo={title:Z.title||"Sign message",description:Z.description||"Signing this message will not cost you any fees.",buttonText:Z.buttonText||"Sign and continue"},to=o=>{o?X(o):Y(J||new v(new w("The user rejected the request.",m.E4001_USER_REJECTED_REQUEST.eipCode))),c({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{G(null),H(""),P(void 0)}),200)};return _.current=()=>{to(W)},/*#__PURE__*/o(t,{children:[/*#__PURE__*/n(u,{onClose:()=>to(W)}),/*#__PURE__*/n(h,{}),Z.iconUrl&&"string"==typeof Z.iconUrl?/*#__PURE__*/n(U,{children:/*#__PURE__*/n(g,{size:"sm",src:Z.iconUrl,alt:"app image"})}):null,/*#__PURE__*/n(b,{children:oo.title}),/*#__PURE__*/n(x,{children:oo.description}),"personal_sign"===B&&/*#__PURE__*/n(f,{children:N(K)}),"eth_signTypedData_v4"===B&&/*#__PURE__*/n(R,{typedData:K}),"solana_signMessage"===B&&/*#__PURE__*/n(f,{children:K}),/*#__PURE__*/n(M,{}),/*#__PURE__*/n(D,{$fail:!0,children:F}),/*#__PURE__*/n(a,{disabled:Q||q||z,loading:Q,onClick:async()=>{$(!0),H("");try{let o=await V();G(o),$(!1),setTimeout((()=>{to(o)}),T)}catch(o){console.error(o),H("An error has occurred, please try again."),P(new v(new w(F,m.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),$(!1)}},children:Q?"Signing...":q?/*#__PURE__*/o(L,{children:[/*#__PURE__*/n(I,{style:{height:"0.9rem",width:"0.9rem"},strokeWidth:2})," ",/*#__PURE__*/n("span",{children:"Success"})]}):oo.buttonText}),Z.isCancellable&&/*#__PURE__*/n(p,{style:{marginTop:"1rem"},onClick:()=>to(null),isSubmitting:!1,children:"Not now"}),/*#__PURE__*/n(d,{}),/*#__PURE__*/n(j,{})]})};let D=/*#__PURE__*/r.div.withConfig({displayName:"InputHelp",componentId:"sc-cc107211-0"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-start;width:100%;margin-top:16px;margin-bottom:4px;"],(o=>o.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),L=/*#__PURE__*/r.span.withConfig({displayName:"ContentWithIcon",componentId:"sc-cc107211-1"})(["display:flex;align-items:center;gap:8px;"]),U=/*#__PURE__*/r.div.withConfig({displayName:"IconContainer",componentId:"sc-cc107211-2"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:82px;"]),M=/*#__PURE__*/r.div.withConfig({displayName:"Grow",componentId:"sc-cc107211-3"})(["flex-grow:1;"]);export{_ as SignRequestScreen};
