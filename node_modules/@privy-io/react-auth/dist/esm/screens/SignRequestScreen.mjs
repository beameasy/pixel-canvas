import{jsxs as o,Fragment as t,jsx as n}from"react/jsx-runtime";import{useState as i,useEffect as e}from"react";import{styled as r}from"styled-components";import{isHex as s,hexToString as c}from"viem";import{ProviderErrors as m}from"@privy-io/js-sdk-core";import{PrimaryButtonWithoutGray as a}from"../components/Button.mjs";import{CopytoClipboardButton as p}from"../components/CopyToClipboard.mjs";import{RefactorSpacerTop as l,RefactorSpacerBottom as h}from"../components/Layouts.mjs";import{BlobbyFooter as d}from"../components/ModalFooter.mjs";import{ModalHeader as j}from"../components/ModalHeader.mjs";import{StyledLogo as f}from"../components/embedded-wallets/StyledLogo.mjs";import{Message as u,DisplayJsonTree as g}from"../components/primitives/JsonTree.mjs";import{Subtitle as y}from"../components/ui/typography/Subtitle.mjs";import{Title as x}from"../components/ui/typography/Title.mjs";import{PrivyProviderRpcError as v,ProviderRpcError as w}from"../connectors/errors.mjs";import{WALLET_PROXY_TIMEOUT as b,DEFAULT_SUCCESS_SCREEN_DURATION_MS as C}from"../constants.mjs";import{usePrivyInternal as T}from"../hooks/internal-context.mjs";import{usePrivyModal as S}from"../hooks/modal-context.mjs";import{usePrivyContext as E}from"../hooks/privy-context.mjs";import{Checkmark as I}from"../svg/checkmark.mjs";import{ModalScreen as k}from"./index.mjs";import"../components/Loader.mjs";import"../svg/copy.mjs";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../hooks/index.mjs";import"../errors.mjs";import"ofetch";import"../components/PrefetchedImage.mjs";let A=o=>{if(!s(o))return o;try{return c(o)}catch{return o}},R=i=>{let{types:e,primaryType:r,...s}=i.typedData;/*#__PURE__*/return o(t,{children:[/*#__PURE__*/n(g,{data:s}),/*#__PURE__*/n(p,{text:(c=i.typedData,JSON.stringify(c,null,2)),itemName:"full payload to clipboard"})," "]});var c};const _=()=>{let{authenticated:r}=E(),{initializeWalletProxy:s,closePrivyModal:c}=T(),{navigate:p,data:g,onUserCloseViaDialogOrKeybindRef:_}=S(),[M,z]=i(!0),[O,F]=i(""),[H,J]=i(),[P,W]=i(null),[G,Q]=i(!1),$=null!==P;e((()=>{r||p(k.LANDING)}),[r]),e((()=>{s(b).then((o=>{z(!1),o||(F("An error has occurred, please try again."),J(new v(new w(O,m.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:q,data:B,confirmAndSign:K,onSuccess:V,onFailure:X,uiOptions:Y}=g.signMessage,Z={title:Y.title||"Sign message",description:Y.description||"Signing this message will not cost you any fees.",buttonText:Y.buttonText||"Sign and continue"},oo=o=>{o?V(o):X(H||new v(new w("The user rejected the request.",m.E4001_USER_REJECTED_REQUEST.eipCode))),c({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{W(null),F(""),J(void 0)}),200)};return _.current=()=>{oo(P)},/*#__PURE__*/o(t,{children:[/*#__PURE__*/n(j,{onClose:()=>oo(P)}),/*#__PURE__*/n(l,{}),Y.iconUrl&&"string"==typeof Y.iconUrl?/*#__PURE__*/n(L,{children:/*#__PURE__*/n(f,{size:"sm",src:Y.iconUrl,alt:"app image"})}):null,/*#__PURE__*/n(x,{children:Z.title}),/*#__PURE__*/n(y,{children:Z.description}),"personal_sign"===q&&/*#__PURE__*/n(u,{children:A(B)}),"eth_signTypedData_v4"===q&&/*#__PURE__*/n(R,{typedData:B}),"solana_signMessage"===q&&/*#__PURE__*/n(u,{children:B}),/*#__PURE__*/n(U,{}),/*#__PURE__*/n(N,{$fail:!0,children:O}),/*#__PURE__*/n(a,{disabled:G||$||M,loading:G,onClick:async()=>{Q(!0),F("");try{let o=await K();W(o),Q(!1),setTimeout((()=>{oo(o)}),C)}catch(o){console.error(o),F("An error has occurred, please try again."),J(new v(new w(O,m.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),Q(!1)}},children:G?"Signing...":$?/*#__PURE__*/o(D,{children:[/*#__PURE__*/n(I,{style:{height:"0.9rem",width:"0.9rem"},strokeWidth:2})," ",/*#__PURE__*/n("span",{children:"Success"})]}):Z.buttonText}),/*#__PURE__*/n(h,{}),/*#__PURE__*/n(d,{})]})};let N=/*#__PURE__*/r.div.withConfig({displayName:"InputHelp",componentId:"sc-1001c856-0"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-start;width:100%;margin-top:16px;margin-bottom:4px;"],(o=>o.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),D=/*#__PURE__*/r.span.withConfig({displayName:"ContentWithIcon",componentId:"sc-1001c856-1"})(["display:flex;align-items:center;gap:8px;"]),L=/*#__PURE__*/r.div.withConfig({displayName:"IconContainer",componentId:"sc-1001c856-2"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:82px;"]),U=/*#__PURE__*/r.div.withConfig({displayName:"Grow",componentId:"sc-1001c856-3"})(["flex-grow:1;"]);export{_ as SignRequestScreen};
