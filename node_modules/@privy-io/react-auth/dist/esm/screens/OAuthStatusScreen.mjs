import{jsxs as o,Fragment as t,jsx as e}from"react/jsx-runtime";import{useState as r,useEffect as i}from"react";import{styled as s}from"styled-components";import{getDisplayForProvider as n}from"../auth-flows/oauth/getDisplayForProvider.mjs";import{SoftCtaButton as m}from"../components/Button.mjs";import{RefactorSpacerTop as c,FixedGappedContainer as a,RefactorSpacerBottom as l}from"../components/Layouts.mjs";import{ConnectionLoader as p}from"../components/Loader.mjs";import{ModalFooter as d}from"../components/ModalFooter.mjs";import{ModalHeader as h}from"../components/ModalHeader.mjs";import u from"../components/layout/StackedContainer.mjs";import{DEFAULT_SUCCESS_SCREEN_DURATION_MS as j}from"../constants.mjs";import{PrivyErrorCode as f,PrivyUserLimitReachedError as g}from"../errors.mjs";import{usePrivyInternal as E}from"../hooks/internal-context.mjs";import{usePrivyModal as v}from"../hooks/modal-context.mjs";import{usePrivyContext as C}from"../hooks/privy-context.mjs";import{shouldProceedtoEmbeddedWalletCreationFlow as y}from"../lib/user/shouldProceedtoEmbeddedWalletCreationFlow.mjs";import{ModalScreen as A}from"./index.mjs";import{getOAuthErrorMessage as T}from"../auth-flows/oauth/getOAuthErrorMessage.mjs";import{stripUrlOAuthParamsAndRemoveStateCode as b}from"../auth-flows/oauth/stripUrlOAuthParamsAndRemoveStateCode.mjs";import"../svg/apple.mjs";import"../svg/discord.mjs";import"../svg/github.mjs";import"../svg/globe.mjs";import"@heroicons/react/24/outline/GlobeAltIcon";import"../svg/google.mjs";import"../svg/instagram.mjs";import"../svg/linkedin.mjs";import"../svg/spotify.mjs";import"../svg/tiktok.mjs";import"../svg/twitter.mjs";import"../configuration/context.mjs";import"../config.mjs";import"../configuration/defaultClientConfig.mjs";import"../configuration/login-methods.mjs";import"../configuration/wallets.mjs";import"../connectors/chains/index.mjs";import"../connectors/chains/arbitrum.mjs";import"../connectors/chains/arbitrumSepolia.mjs";import"../connectors/chains/avalanche.mjs";import"../connectors/chains/avalancheFuji.mjs";import"../connectors/chains/base.mjs";import"../connectors/chains/baseSepolia.mjs";import"../connectors/chains/berachainArtio.mjs";import"../connectors/chains/celo.mjs";import"../connectors/chains/celoAlfajores.mjs";import"../connectors/chains/filecoin.mjs";import"../connectors/chains/filecoinCalibration.mjs";import"../connectors/chains/garnetHolesky.mjs";import"../connectors/chains/holesky.mjs";import"../connectors/chains/linea.mjs";import"../connectors/chains/lineaTestnet.mjs";import"../connectors/chains/lukso.mjs";import"../connectors/chains/mainnet.mjs";import"../connectors/chains/optimism.mjs";import"../connectors/chains/optimismSepolia.mjs";import"../connectors/chains/polygon.mjs";import"../connectors/chains/polygonAmoy.mjs";import"../connectors/chains/redstone.mjs";import"../connectors/chains/sepolia.mjs";import"../connectors/chains/zora.mjs";import"../connectors/chains/zoraSepolia.mjs";import"../connectors/chains/zoraTestnet.mjs";import"../connectors/chains/utils.mjs";import"../lib/solana/index.mjs";import"../theme.mjs";import"tinycolor2";import"../lib/cybr53.mjs";import"../svg/protected-by-privy.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../hooks/index.mjs";import"ofetch";import"../components/PrefetchedImage.mjs";import"../lib/user/shouldCreateEmbeddedEthWallet.mjs";import"../client/user.mjs";import"viem/utils";import"../lib/user/shouldCreateEmbeddedSolWallet.mjs";import"../lib/capitalizeFirstLetter.mjs";import"../storage.mjs";const S=()=>{let{authenticated:s,logout:S,ready:N,user:R}=C(),{app:I,setModalData:O,navigate:x,resetNavigation:L}=v(),{getAuthMeta:k,initLoginWithOAuth:w,loginWithOAuth:U,updateWallets:M,setReadyToTrue:W,closePrivyModal:D,createAnalyticsEvent:F}=E(),[P,z]=r(!1),[H,J]=r(void 0),B=k()?.provider||"google",{name:Q,component:V}=n(B);i((()=>{U(B).then((()=>{z(!0),W(!0)})).catch((o=>{if(W(!1),o?.privyErrorCode===f.ALLOWLIST_REJECTED)return J(void 0),L(),void x(A.ALLOWLIST_REJECTION_SCREEN);if(o?.privyErrorCode===f.USER_LIMIT_REACHED)return console.error(new g(o).toString()),J(void 0),L(),void x(A.USER_LIMIT_REACHED_SCREEN);if(o?.privyErrorCode===f.USER_DOES_NOT_EXIST)return J(void 0),L(),void x(A.ACCOUNT_NOT_FOUND_SCREEN);if(o?.privyErrorCode===f.ACCOUNT_TRANSFER_REQUIRED&&o.data?.data?.nonce)return J(void 0),L(),O({accountTransfer:{nonce:o.data?.data?.nonce,account:o.data?.data?.subject,displayName:o.data?.data?.account?.displayName,linkMethod:k()?.provider,embeddedWalletAddress:o.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:o.data?.data?.otherUser?.oAuthUserInfo}}),void x(A.LINK_CONFLICT_SCREEN);let{retryable:t,detail:e}=T(o,B);J({retryable:t,detail:e,message:"Authentication failed"})})).finally((()=>{b()}))}),[Q,B]),i((()=>{if(N&&s&&P&&R){if(I?.legal.requireUsersAcceptTerms&&!R.hasAcceptedTerms){let o=setTimeout((()=>{x(A.AFFIRMATIVE_CONSENT_SCREEN)}),j);return()=>clearTimeout(o)}if(y(R,I.embeddedWallets)){let o=setTimeout((()=>{O({createWallet:{onSuccess:()=>{},onFailure:o=>{console.error(o),F({eventName:"embedded_wallet_creation_failure_logout",payload:{error:o,provider:B,screen:"OAuthStatusScreen"}}),S()},callAuthOnSuccessOnClose:!0}}),x(A.EMBEDDED_WALLET_ON_ACCOUNT_CREATE_SCREEN)}),j);return()=>clearTimeout(o)}{let o=setTimeout((()=>D({shouldCallAuthOnSuccess:!0,isSuccess:!0})),j);return M(),()=>clearTimeout(o)}}}),[N,s,P,R]);let X=P?`Successfully connected with ${Q}`:H?H.message:`Verifying connection to ${Q}`,$="";return $=P?"Youâ€™re good to go!":H?H.detail:"Just a few moments more",/*#__PURE__*/o(t,{children:[/*#__PURE__*/e(h,{}),/*#__PURE__*/e(c,{}),/*#__PURE__*/o(_,{children:[/*#__PURE__*/e(u,{children:/*#__PURE__*/o("div",{children:[/*#__PURE__*/e(p,{success:P,fail:!!H}),/*#__PURE__*/e(V,{style:{width:"38px",height:"38px"}})]})}),/*#__PURE__*/o(a,{children:[/*#__PURE__*/e("h3",{children:X}),/*#__PURE__*/e("p",{children:$})]}),H&&H?.retryable?/*#__PURE__*/e(m,{onClick:()=>{b(),w(B),J(void 0)},disabled:!P&&!H?.retryable,children:"Retry"}):null]}),/*#__PURE__*/e(l,{}),/*#__PURE__*/e(d,{})]})};let _=/*#__PURE__*/s.div.withConfig({displayName:"ConnectContainer",componentId:"sc-814a2c46-0"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;margin-left:27px;margin-right:27px;gap:24px;"]);export{S as OAuthStatusScreen};
