import{jsx as o,Fragment as e,jsxs as n}from"react/jsx-runtime";import{useState as t,useEffect as r,useMemo as s}from"react";import{formatUnits as i}from"viem";import{formatTokenAmount as a,formatWeiAmount as m}from"@privy-io/js-sdk-core";import{PrimaryButton as c}from"../../components/Button.mjs";import{FlexContainer as l}from"../../components/Layouts.mjs";import{BlobbyFooter as p}from"../../components/ModalFooter.mjs";import{QrCode as d}from"../../components/QrCode.mjs";import u from"../../components/embedded-wallets/FundWalletMethodHeader.mjs";import{InfoBanner as h}from"../../components/ui/banners/InfoBanner.mjs";import{Subtitle as j}from"../../components/ui/typography/Subtitle.mjs";import{Title as f}from"../../components/ui/typography/Title.mjs";import{WalletInfoCard as g}from"../../components/ui/wallet/WalletInfoCard.mjs";import{useAppConfig as y}from"../../configuration/context.mjs";import{usePrivyInternal as v}from"../../hooks/internal-context.mjs";import{usePrivyModal as b}from"../../hooks/modal-context.mjs";import{useWalletBalance as C}from"../../hooks/useWalletBalance.mjs";import{useWallets as I}from"../../hooks/useWallets.mjs";import{ON_RAMP_COMPLETE_ANALYTICS_EVENT as k}from"../../lib/funding/analytics.mjs";import{getNativeCurrencyFromLamports as S}from"../../lib/solana/transaction.mjs";import{getErc20Balance as w}from"../../lib/wallets/actions/getErc20Balance.mjs";import{usePlugins as T}from"../../plugins/context/PrivyPluginContext.mjs";import{SOLANA_FUNDING_PLUGIN_ID as E}from"../../plugins/solana-funding/id.mjs";import{Blobby as A}from"../../svg/blobby.mjs";import{formatWalletAddress as x}from"../../utils/index.mjs";import{ModalScreen as M}from"../index.mjs";import{useSolanaWallets as L}from"../../hooks/solana/useSolanaWallets.mjs";import"styled-components";import"../../components/Loader.mjs";import"../../svg/protected-by-privy.mjs";import"../../config.mjs";import"../../configuration/defaultClientConfig.mjs";import"../../constants.mjs";import"../../configuration/login-methods.mjs";import"../../configuration/wallets.mjs";import"../../connectors/chains/index.mjs";import"../../connectors/chains/arbitrum.mjs";import"../../connectors/chains/arbitrumSepolia.mjs";import"../../connectors/chains/avalanche.mjs";import"../../connectors/chains/avalancheFuji.mjs";import"../../connectors/chains/base.mjs";import"../../connectors/chains/baseSepolia.mjs";import"../../connectors/chains/berachainArtio.mjs";import"../../connectors/chains/celo.mjs";import"../../connectors/chains/celoAlfajores.mjs";import"../../connectors/chains/filecoin.mjs";import"../../connectors/chains/filecoinCalibration.mjs";import"../../connectors/chains/garnetHolesky.mjs";import"../../connectors/chains/holesky.mjs";import"../../connectors/chains/linea.mjs";import"../../connectors/chains/lineaTestnet.mjs";import"../../connectors/chains/lukso.mjs";import"../../connectors/chains/mainnet.mjs";import"../../connectors/chains/optimism.mjs";import"../../connectors/chains/optimismSepolia.mjs";import"../../connectors/chains/polygon.mjs";import"../../connectors/chains/polygonAmoy.mjs";import"../../connectors/chains/redstone.mjs";import"../../connectors/chains/sepolia.mjs";import"../../connectors/chains/zora.mjs";import"../../connectors/chains/zoraSepolia.mjs";import"../../connectors/chains/zoraTestnet.mjs";import"../../connectors/chains/utils.mjs";import"../../lib/solana/index.mjs";import"../../theme.mjs";import"tinycolor2";import"../../lib/cybr53.mjs";import"qrcode";import"../../svg/black-rounded-square.mjs";import"../../connectors/get-legacy-injected-providers.mjs";import"../../connectors/is-wallet-installed.mjs";import"../../errors.mjs";import"ofetch";import"../../utils/eth/getPublicClient.mjs";import"../../components/ModalHeader.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"../../hooks/index.mjs";import"@heroicons/react/24/outline/InformationCircleIcon";import"../../components/ui/chips/Chip.mjs";import"../../components/ui/animation/LoadingSkeleton.mjs";import"../../components/ui/layout/Column.mjs";import"../../components/ui/typography/ErrorMessage.mjs";import"../../components/ui/typography/LabelXs.mjs";import"../../components/ui/wallet/Address.mjs";import"@heroicons/react/24/outline/CheckIcon";import"@heroicons/react/24/outline/Square2StackIcon";import"../../components/ui/wallet/shared.mjs";import"../../components/PrefetchedImage.mjs";import"../../utils/buffer/readBigInt64LE.mjs";import"../../lib/attempt.mjs";const B=()=>{let{wallets:A}=I(),{wallets:B}=L(),{data:D,setModalData:O,navigate:P,lastScreen:F}=b(),{rpcConfig:H,appId:W,createAnalyticsEvent:q,closePrivyModal:z}=v(),$=y(),[_,U]=t(void 0),[Q,X]=t(!1),G=T(),Y=D?.funding,{reloadBalance:J}=C({rpcConfig:H,appId:W,address:"ethereum"===Y.chainType?Y.address:void 0,chain:"ethereum"===Y.chainType?Y.chain:void 0}),K="solana"===Y.chainType,V=K?"SOL":Y.erc20Address?Y.erc20ContractInfo?.symbol:Y.chain.nativeCurrency.symbol,Z=K?B.find((({address:o})=>o===Y.address)):A.find((({address:o})=>x(o)===x(Y.address)));if(!Y)return O({errorModalData:{error:Error("Couldn't find funding config"),previousScreen:F||M.FUNDING_METHOD_SELECTION_SCREEN},funding:D?.funding,sendTransaction:D?.sendTransaction}),P(M.ERROR_SCREEN),/*#__PURE__*/o(e,{});r((()=>{let o=K?async function(){if("solana"!==Y.chainType)return;let o=G(E);o?o.getBalance({address:Y.address,cluster:Y.cluster}).then((o=>{let e=BigInt(o);_&&e>_&&(X(!0),q({eventName:k,payload:{provider:"manual",status:"success",chainType:"solana",address:Z?.address,value:i(e-_,9),token:"SOL"}})),U(e)})):console.warn("Unable to load solana plugin, skipping balance")}:async function(){"ethereum"===Y.chainType&&(async()=>{if(!Y.erc20Address)return await J()??BigInt(0);{let{balance:o}=await w({chain:Y.chain,address:Y.address,erc20Address:Y.erc20Address,rpcConfig:H,appId:W});return o}})().then((o=>{_&&o>_&&(X(!0),q({eventName:k,payload:{provider:"manual",status:"success",chainType:"ethereum",address:Z?.address,chainId:Y.chain.id,value:i(o-_,Y.erc20ContractInfo?.decimals??18),token:Y.erc20ContractInfo?.symbol??Y.erc20Address??"ETH"}})),U(o)})).catch((()=>U(void 0)))},e=setInterval(o,2e3);return o(),()=>clearInterval(e)}),[_]);let oo=s((()=>void 0!==_&&_>=parseFloat(Y.amount)),[_,Y.amount]),eo=s((()=>null==_?"":Y.isUSDC?a({amount:_,decimals:6}):K?S(_,3,!0,!0):null!=Y.erc20ContractInfo?.decimals?a({amount:_,decimals:Y.erc20ContractInfo.decimals}):m({wei:_})),[_,K,Y]),no="ethereum"===Y.chainType?Y.chain.name:R[Y.cluster.name];/*#__PURE__*/return n(e,{children:[/*#__PURE__*/o(u,{}),/*#__PURE__*/n(f,{children:["Receive ",Y.amount," ",V]}),/*#__PURE__*/n(j,{children:["Scan this code or copy your wallet address to receive funds on ",no,"."]}),/*#__PURE__*/n(l,{style:{gap:"1rem",margin:"1rem 0"},children:[/*#__PURE__*/o(d,{url:`${Y.chainType}:${Y.address}`,size:200,squareLogoElement:N}),/*#__PURE__*/n(h,{theme:$.appearance.palette.colorScheme,children:["Make sure to send funds on ",no,"."]}),/*#__PURE__*/o(g,{title:"Your wallet",errMsg:void 0,showIcon:!0,isLoading:!Y||void 0===_,isPulsing:!oo,balance:`${eo} ${V}`,address:Y.address,statusColor:oo?"green":"gray"}),Q&&/*#__PURE__*/o(c,{onClick:()=>z({shouldCallAuthOnSuccess:!1,isSuccess:!0}),children:"Continue"})]}),/*#__PURE__*/o(p,{})]})};let N=({...e})=>/*#__PURE__*/o(A,{color:"black",...e}),R={devnet:"Devnet","mainnet-beta":"Solana",testnet:"Testnet"};export{B as ManualTransferScreen};
