"use strict";var e=require("../connectors/get-legacy-injected-providers.js"),t=require("../connectors/is-wallet-installed.js"),r=require("../errors.js"),n=require("./eth/getPublicClient.js");require("ofetch"),require("viem");const o=(e,t=3,r=4,n="ethereum")=>{if(!e)return"";let o="ethereum"===n?2:0;return t+r+o+3>=e.length?e:`${e.slice(0,o+t)}...${e.slice(e.length-r,e.length)}`},i=e=>new Promise((t=>setTimeout(t,e)));const s=(e,t)=>e.toLowerCase()===t.toLowerCase(),a=e=>e.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"");exports.clamp=function(e,{min:t,max:r}){return Math.min(Math.max(e,t),r)},exports.constructURL=(e,t,r={},n={})=>{let o=new URL(t,e);for(let[e,t]of Object.entries(r))void 0!==t&&o.searchParams.set(e,t);let i=Object.entries(n);if(i.length>0){let e=new URLSearchParams;for(let[t,r]of i)e.append(t,r);o.hash=e.toString()}return o.href},exports.containsEthAddress=(e,t)=>{for(let r of e)if(s(r,t))return!0;return!1},exports.convert1dTo2dArray=(e,t)=>{let r=e.slice(0),n=[];for(;r.length;)n.push(r.splice(0,t));return n},exports.detectInjectedConnectors=async function({store:r,walletList:n,externalWalletConfig:o,walletChainType:i,timeout:s=3e3}){let a=!1,l=window;return new Promise((u=>{function p(){if(a)return;a=!0,window.removeEventListener("ethereum#initialized",p);let s=r.getProviders();console.debug("Detected injected providers:",s.map((e=>e.info)));let l=[];for(let e of s)n.includes("coinbase_wallet")&&"com.coinbase.wallet"===e.info.rdns||"solana-only"===i&&"app.phantom"===e.info.rdns||l.push({type:e.info.name.toLowerCase().replace(/\s/g,"_"),eip6963InjectedProvider:e});if("solana-only"!==i)for(let r of e.getLegacyInjectedProviders()){let n=e.getLegacyInjectedName(r);if(!s.some((e=>e.info.name===n))){if(t.isMetaMask(r,!0)&&!l.find((e=>"metamask"===e.type))){l.push({type:"metamask",legacyInjectedProvider:r});continue}if("Phantom"===n&&!l.find((e=>"phantom"===e.type))){l.push({type:"phantom",legacyInjectedProvider:r});continue}if("Coinbase Wallet"===n&&!l.find((e=>"coinbase_wallet"===e.type&&"smartWalletOnly"!==o.coinbaseWallet?.connectionOptions))){l.push({type:"coinbase_wallet",legacyInjectedProvider:r});continue}l.find((e=>"unknown_browser_extension"===e.type))||l.push({type:"unknown_browser_extension",legacyInjectedProvider:r})}}u(l)}l.ethereum?p():(window.addEventListener("ethereum#initialized",p,{once:!0}),setTimeout((()=>{p()}),s))}))},exports.formatChainIdToCAIP2=function(e){return`eip155:${String(Number(e))}`},exports.formatSolanaWalletAddress=(e,t=3,r=4)=>o(e,t,r,"solana"),exports.formatWalletAddress=o,exports.generateTypedDataWithDomainType=e=>{let t={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},r=e.types.EIP712Domain??Object.entries(e.domain).map((([e,r])=>{if(null!=r&&"string"==typeof e&&e in t)return{name:e,type:t[e]}})).filter((e=>void 0!==e));return{...e,types:{...e.types,EIP712Domain:r}}},exports.getBlockExplorer=(e,t)=>{let n=Number(e),o=t.find((e=>e.id===n));if(!o)throw new r.PrivyConnectorError(`Unsupported chainId ${e}`,4901);return o.blockExplorers?.default.url},exports.getJsonRpcEndpoint=(e,t,o,i)=>{let s=Number(e),a=t.find((e=>e.id===s));if(!a)throw new r.PrivyConnectorError(`Unsupported chainId ${e}`,4901);return n.getJsonRpcEndpointFromChain(a,o,i)},exports.invokeUntilSettled=(e,t={})=>{let r=t.delayMs||150,n=t.maxAttempts||270;return new Promise((async(o,s)=>{let a=!1,l=0;for(;!a&&l<n;){if(t.abortSignal?.aborted)return;e().then((e=>{a=!0,o(e)}),((...e)=>{a=!0,s(...e)})),l+=1,await i(r)}a||s(Error("Exceeded max attempts before resolving function"))}))},exports.normalizeWalletShortName=e=>a(e).toLowerCase().replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s/g,"_"),exports.pollForResult=function(e,{interval:t=100,timeout:r=5e3}={}){return new Promise(((n,o)=>{let i,s=0,a=()=>{s>=r?o("Max attempts reached without result"):(i=e(),s+=t,null==i?setTimeout(a,t):n(i))};a()}))},exports.sameEthAddress=s,exports.sleep=i,exports.splitAtIndex=(e,t)=>{let r=[],n=[];for(let[o,i]of e.entries())o<t?r.push(i):n.push(i);return[r,n]},exports.stripEmoji=a,exports.toHex=e=>"string"==typeof e?e:"0x"+e.toString(16),exports.validateEmail=e=>!!String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);
