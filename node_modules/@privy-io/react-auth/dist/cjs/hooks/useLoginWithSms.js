"use strict";var e=require("react"),r=require("../errors.js"),t=require("./captcha-context.js"),s=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../utils/eth/getPublicClient.js"),require("viem");exports.useLoginWithSms=i=>{let o=t.useCaptcha(),{smsOtpState:a,setSmsOtpState:n,initLoginWithSms:u,loginWithCode:c}=s.usePrivyInternal();return{sendCode:e.useCallback((async({phoneNumber:e,disableSignup:s})=>{try{let i;if(!e)throw Error("SMS required to send OTP code");if(o.enabled&&"error"===o.status)throw new t.CaptchaError(o.error,null,r.PrivyErrorCode.CAPTCHA_FAILURE);return o.enabled&&"success"!==o.status&&(o.execute(),i=await o.waitForResult()),await u({phoneNumber:e,captchaToken:i,disableSignup:s,withPrivyUi:!1})}catch(e){throw n({status:"error",error:e}),i?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR),e}}),[u]),loginWithCode:e.useCallback((async({code:e})=>{try{if(o.enabled&&"success"!==o.status)throw new t.CaptchaError(o.error,null,r.PrivyErrorCode.CAPTCHA_FAILURE);let{user:s,isNewUser:a,wasAlreadyAuthenticated:n,linkedAccount:u}=await c(e);i?.onComplete?.({user:s,isNewUser:a,wasAlreadyAuthenticated:n,loginMethod:"sms",loginAccount:u})}catch(e){throw n({status:"error",error:e}),i?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR),e}}),[c,o.status]),state:a}};
