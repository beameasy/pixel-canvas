"use strict";var e=require("react"),r=require("../errors.js"),t=require("./captcha-context.js"),s=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../utils/eth/getPublicClient.js"),require("viem");exports.useLoginWithPasskey=i=>{let a=t.useCaptcha(),{initLoginWithPasskey:o,loginWithPasskey:u,passkeyAuthState:n,setPasskeyAuthState:c}=s.usePrivyInternal();return{loginWithPasskey:e.useCallback((async()=>{try{let e;if(a.enabled&&"error"===a.status)throw new t.CaptchaError(a.error,null,r.PrivyErrorCode.CAPTCHA_FAILURE);a.enabled&&"success"!==a.status&&(a.execute(),e=await a.waitForResult()),await o({captchaToken:e,withPrivyUi:!1});let{user:s,isNewUser:n,wasAlreadyAuthenticated:c,loginAccount:l}=await u();i?.onComplete?.({user:s,isNewUser:n,wasAlreadyAuthenticated:c,loginMethod:"passkey",loginAccount:l})}catch(e){throw c({status:"error",error:e}),i?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR),e}}),[u,a.status]),state:n}};
