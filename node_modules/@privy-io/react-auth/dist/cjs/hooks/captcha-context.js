"use strict";var e=require("react/jsx-runtime"),t=require("./index.js"),r=require("react"),s=require("../errors.js"),o=require("../utils/index.js");require("ofetch"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../utils/eth/getPublicClient.js"),require("viem");const i=/*#__PURE__*/r.createContext({siteKey:"",enabled:!1,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:t.notImplemented,setError:t.notImplemented,setExecuting:t.notImplemented,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:t.notImplemented,reset:t.notImplemented,execute:t.notImplemented});class a extends s.PrivyError{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}exports.CaptchaContext=i,exports.CaptchaError=a,exports.CaptchaProvider=({children:t,id:n,captchaSiteKey:u,captchaEnabled:c})=>{let l=r.useRef(null),[d,p]=r.useState(),[v,m]=r.useState(),[h,x]=r.useState(!1),C=r.useMemo((()=>c?h||d||v?!h||d||v?d&&!v?{status:"success",token:d}:v?{status:"error",error:v}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"}),[c,d,v,h]);/*#__PURE__*/return e.jsx(i.Provider,{value:{...C,ref:l,enabled:c,siteKey:u,appId:n,setToken:p,setError:m,setExecuting:x,remove(){c&&(l.current?.remove(),x(!1),m(void 0),p(void 0))},reset(){c&&(l.current?.reset(),x(!1),m(void 0),p(void 0))},execute(){c&&(x(!0),l.current?.execute())},async waitForResult(){if(!c)return"";try{return await o.pollForResult((()=>l.current?.getResponse()),{interval:200,timeout:2e4})}catch(e){throw new a("Captcha failed",null,s.PrivyErrorCode.CAPTCHA_TIMEOUT)}}},children:t})},exports.useCaptcha=()=>r.useContext(i);
