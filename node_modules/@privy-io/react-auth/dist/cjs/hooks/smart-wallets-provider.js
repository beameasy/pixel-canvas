"use strict";var e=require("react/jsx-runtime"),r=require("react"),i=require("../configuration/context.js"),n=require("../errors.js"),t=require("../lib/getEmbeddedConnectedWallet.js"),s=require("../lib/smart-wallets.js"),a=require("./index.js"),o=require("./internal-context.js"),c=require("./privy-context.js"),l=require("./useWallets.js");require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("ofetch"),require("viem"),require("../client/user.js"),require("viem/utils"),require("./modal-context.js"),require("../components/PrefetchedImage.js"),require("../screens/index.js"),require("./useSmartWalletChain.js"),require("../utils/eth/getPublicClient.js"),require("../lib/smart-wallets-shared.js"),require("permissionless"),require("permissionless/accounts"),require("permissionless/clients/pimlico"),require("viem/account-abstraction"),require("@privy-io/js-sdk-core");let u=/*#__PURE__*/r.createContext({client:void 0,getClientForChain:a.notImplemented});let d=/*#__PURE__*/r.createContext({config:void 0}),h=()=>{let{config:e}=r.useContext(d);return{config:e}},g=({children:i})=>{let[n,t]=r.useState(void 0),{client:s}=o.usePrivyInternal();return r.useEffect((()=>{!n&&s&&(async()=>{try{if(!s)return void console.warn("No client found");let e=await s.getSmartWalletsConfig();t(e)}catch(e){console.warn("Error generating smart wallet config: ",e)}})()}),[!!s]),/*#__PURE__*/e.jsx(d.Provider,{value:{config:n},children:i})},m=({config:a,children:u})=>{let{config:d}=h(),{appId:g}=o.usePrivyInternal(),{chains:m,defaultChain:q,rpcConfig:j}=i.useAppConfig(),{wallets:C}=l.useWallets(),{user:p}=c.usePrivyContext(),[y,v]=r.useState(),{wrapSmartAccountClientWithUIs:W}=s.useSmartWalletsUIWrapper(),x=t.getEmbeddedConnectedWallet(C);r.useEffect((()=>{(async()=>{if(!d?.enabled)return;let e=d.configuredNetworks.find((e=>e.chainId===`eip155:${q.id}`))?q:m.find((e=>d.configuredNetworks.map((e=>e.chainId)).includes(`eip155:${e.id}`)));if(!e)throw new n.PrivyClientError("Could not find smart wallets chain configurations for any Privy client configured chains. Please configure smart wallets for your chains in the Privy dashboard.");v(await s.getSmartWalletClient({chain:e,privyAppId:g,paymasterContext:a?.paymasterContext,rpcConfig:j,embeddedWallet:x,user:p,smartWalletsConfig:d}))})()}),[!!d?.enabled,!!p?.smartWallet,!!x]);/*#__PURE__*/return e.jsx(f.Provider,{value:{client:y,config:a,getClientForChain:async({id:e})=>{let r=t.getEmbeddedConnectedWallet(C),i=await s.getSmartWalletClient({chain:m.find((r=>r.id===e)),privyAppId:g,paymasterContext:a?.paymasterContext,rpcConfig:j,embeddedWallet:r,user:p,smartWalletsConfig:d});if(!i)throw new n.PrivyClientError(`Failed to create smart wallet client for chain id: ${e}`);return W(i)}},children:u})},f=/*#__PURE__*/r.createContext({client:void 0,config:void 0,getClientForChain:a.notImplemented}),q=({children:i})=>{let{client:n,config:t,getClientForChain:a}=(()=>{let{client:e,config:i,getClientForChain:n}=r.useContext(f);return{client:e,config:i,getClientForChain:n}})(),{config:l}=h(),{wrapSmartAccountClient:d}=s.useSmartWalletsWrapper({clientConfig:t,smartWalletsConfig:l}),{user:g}=c.usePrivyContext(),{generateSiweMessageForSmartWallet:m,linkSmartWallet:q,hideWalletUIs:j}=o.usePrivyInternal();return r.useEffect((()=>{(async()=>{if(n&&g&&!g?.smartWallet&&l?.enabled)try{let e=await m({address:n.account.address,chainId:`eip155:${n.chain.id}`});j.current=!0;let r=await n.signMessage({message:e});await q({signature:r,message:e,smartWalletType:l.smartWalletType})}catch(e){console.error("Error creating smart wallet:",e)}finally{j.current=!1}})()}),[!!n,!!g?.smartWallet,!!l?.enabled]),/*#__PURE__*/e.jsx(u.Provider,{value:{client:g?.smartWallet&&n?d(n):void 0,getClientForChain:a},children:i})};exports.SmartWalletsProvider=({config:r,children:i})=>/*#__PURE__*/e.jsx(g,{children:/*#__PURE__*/e.jsx(m,{config:r,children:/*#__PURE__*/e.jsx(q,{children:i})})}),exports.useSmartWallets=()=>{let{client:e,getClientForChain:i}=r.useContext(u);return{client:e,getClientForChain:i}};
