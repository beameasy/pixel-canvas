"use strict";var e=require("@solana/web3.js"),r=require("react"),n=require("../configuration/context.js"),s=require("../connectors/isBaseConnectedEthereumWallet.js"),i=require("../connectors/solana/index.js"),a=require("../lib/caip2.js"),o=require("../lib/erc20/actions/getErc20TokenInfo.js"),c=require("../lib/erc20/formatErc20TokenAmount.js"),t=require("../lib/wallets/actions/getErc20Balance.js"),u=require("../privy-components/wallets-pill/state.js"),l=require("./internal-context.js");require("react/jsx-runtime"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("./index.js"),require("../connectors/base.js"),require("eventemitter3"),require("../connectors/errors.js"),require("@privy-io/js-sdk-core"),require("../errors.js"),require("ofetch"),require("../connectors/stored-connection.js"),require("../storage.js"),require("viem"),require("../utils/eth/getPublicClient.js"),require("zustand"),require("zustand/shallow"),require("zustand/traditional");let d=async({wallet:e,chains:r,tokens:n,rpcConfig:s,appId:i})=>{let u=r.find((r=>r.id===a.extractChainIdFromCAIP2(e.chainId)));if(!u)return[];let l=n.filter((e=>e.chain.id===u.id)).map((r=>(async({address:e,erc20:r,chain:n,rpcConfig:s,appId:i})=>{let[a,{balance:u}]=await Promise.all([await o.getErc20TokenInfo({chain:n,address:r.address,rpcConfig:s,privyAppId:i}),await t.getErc20Balance({chain:n,address:e,erc20Address:r.address,rpcConfig:s,appId:i})]);if(!a||u<=0n)return;let l=Number(c.formatErc20TokenAmount({amount:u,decimals:a.decimals}).replace(",","")).toFixed(2);return{amount:l,usdAmount:Number(l),symbol:a.symbol,icon:r.icon}})({address:e.address,erc20:r,chain:u,rpcConfig:s,appId:i})));return(await Promise.all(l)).filter((e=>!!e))},q=async({wallet:r,tokens:n,solanaClusters:s})=>{let i=n.map((n=>(async({wallet:r,spl:n,solanaClusters:s})=>{let i=new e.Connection(s[n.cluster],"confirmed"),a=new e.PublicKey(r.address),o=new e.PublicKey(n.address),c=await i.getParsedTokenAccountsByOwner(a,{mint:o});if(c.value.length<=0||!c.value[0])return;let t=Number(c.value[0].account.data.parsed.info.tokenAmount.uiAmount);return t<=0?void 0:{amount:t.toFixed(2),usdAmount:t,symbol:n.ticker,icon:n.icon}})({wallet:r,spl:n,solanaClusters:s})));return(await Promise.all(i)).filter((e=>!!e))};exports.useFormattedBalances=({wallet:e,enabled:a,assets:o})=>{let c=u.useBalance(e.address,"solana"===e.type?"solana":e.chainId),[t,j]=r.useState(!0),{solanaClusters:h}=n.useAppConfig(),{chains:p,rpcConfig:m,appId:f}=l.usePrivyInternal(),b=r.useMemo((()=>(c||[]).map((e=>e.usdAmount)).reduce(((e,r)=>e+r),0)),[c]);return r.useEffect((()=>{a?(async()=>{j(void 0===c),s.isBaseConnectedEthereumWallet(e)?u.updateBalance(e.address,e.chainId,await d({wallet:e,chains:p,tokens:o.ethereum,rpcConfig:m,appId:f})):i.isBaseConnectedSolanaWallet(e)&&u.updateBalance(e.address,"solana",await q({wallet:e,tokens:o.solana,solanaClusters:h})),j(!1)})().catch(console.error):j(!1)}),[e,a]),{balances:c??[],isLoading:t,totalUsdBalance:b}};
