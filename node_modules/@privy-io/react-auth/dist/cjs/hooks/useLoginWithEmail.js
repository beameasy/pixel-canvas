"use strict";var r=require("react"),e=require("../errors.js"),t=require("./captcha-context.js"),i=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../utils/eth/getPublicClient.js"),require("viem");exports.useLoginWithEmail=a=>{let o=t.useCaptcha(),{emailOtpState:s,setEmailOtpState:n,initLoginWithEmail:l,loginWithCode:u}=i.usePrivyInternal();return{sendCode:r.useCallback((async({email:r,disableSignup:i})=>{try{let a;if(!r)throw Error("Email required to send OTP code");if(o.enabled&&"error"===o.status)throw new t.CaptchaError(o.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);return o.enabled&&"success"!==o.status&&(o.execute(),a=await o.waitForResult()),await l({email:r,captchaToken:a,disableSignup:i,withPrivyUi:!1})}catch(r){throw n({status:"error",error:r}),a?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[l]),loginWithCode:r.useCallback((async({code:r})=>{try{if(o.enabled&&"error"===o.status)throw new t.CaptchaError(o.error,null,e.PrivyErrorCode.CAPTCHA_FAILURE);let{user:i,isNewUser:s,wasAlreadyAuthenticated:n,linkedAccount:l}=await u(r);a?.onComplete?.({user:i,isNewUser:s,wasAlreadyAuthenticated:n,loginMethod:"email",loginAccount:l})}catch(r){throw n({status:"error",error:r}),a?.onError?.(r.privyErrorCode||e.PrivyErrorCode.UNKNOWN_AUTH_ERROR),r}}),[u,o.status]),state:s}};
