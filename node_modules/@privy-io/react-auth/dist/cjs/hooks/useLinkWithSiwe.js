"use strict";var e=require("react"),r=require("../errors.js"),t=require("./captcha-context.js"),i=require("./internal-context.js");require("ofetch"),require("react/jsx-runtime"),require("./index.js"),require("../utils/index.js"),require("../connectors/get-legacy-injected-providers.js"),require("../connectors/is-wallet-installed.js"),require("../utils/eth/getPublicClient.js"),require("viem");exports.useLinkWithSiwe=s=>{let n=t.useCaptcha(),{siweState:a,setSiweState:o,linkWithSiwe:c,generateSiweMessage:u}=i.usePrivyInternal();return{generateSiweMessage:e.useCallback((async({address:e,chainId:t})=>{try{if(!e||!t)throw Error("wallet address and chainId required to generate nonce");return await u({address:e,chainId:t}).then((e=>e))}catch(e){throw o({status:"error",error:e}),s?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR,{linkMethod:"siwe"}),e}}),[u]),linkWithSiwe:e.useCallback((async({signature:e,message:i,chainId:a,walletClientType:u,connectorType:l})=>{try{if(n.enabled&&"success"!==n.status)throw new t.CaptchaError(n.error,null,r.PrivyErrorCode.CAPTCHA_FAILURE);let{user:o,linkedAccount:d}=await c({message:i,signature:e,chainId:a,walletClientType:u,connectorType:l});d&&s?.onSuccess?.({user:o,linkMethod:"siwe",linkedAccount:d})}catch(e){throw o({status:"error",error:e}),s?.onError?.(e.privyErrorCode||r.PrivyErrorCode.UNKNOWN_AUTH_ERROR,{linkMethod:"siwe"}),e}}),[c,n.status]),state:a}};
