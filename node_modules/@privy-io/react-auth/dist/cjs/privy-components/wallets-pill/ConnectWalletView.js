"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),r=require("@headlessui/react"),n=require("@heroicons/react/24/outline"),i=require("@heroicons/react/24/outline/ArrowLeftIcon"),t=require("react"),o=require("react-device-detect"),s=require("styled-components"),a=require("../../components/Button.js"),l=require("../../components/QrCode.js"),c=require("../../components/ui/forms/EmailInputForm.js"),u=require("../../components/ui/typography/Subtitle.js"),d=require("../../components/ui/typography/Title.js"),h=require("../../configuration/context.js"),j=require("../../connectors/walletconnect-client.js"),m=require("../../constants.js"),g=require("../../hooks/internal-context.js"),p=require("../../screens/ConnectionStatusScreen.js"),q=require("../../svg/wallet-connect.js"),w=require("../shared/X.js"),f=require("./data/wcRegistryPatch.js"),x=require("./icons/EVM.js"),y=require("./icons/Solana.js"),v=require("./state.js"),b=require("./styles.js");function C(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("../../components/Loader.js"),require("qrcode"),require("../../svg/black-rounded-square.js"),require("../../utils/index.js"),require("../../connectors/get-legacy-injected-providers.js"),require("../../connectors/is-wallet-installed.js"),require("../../errors.js"),require("ofetch"),require("../../utils/eth/getPublicClient.js"),require("viem"),require("../../components/ui/typography/ErrorMessage.js"),require("../../config.js"),require("../../configuration/defaultClientConfig.js"),require("../../configuration/login-methods.js"),require("../../configuration/wallets.js"),require("../../connectors/chains/index.js"),require("../../connectors/chains/arbitrum.js"),require("../../connectors/chains/arbitrumSepolia.js"),require("../../connectors/chains/avalanche.js"),require("../../connectors/chains/avalancheFuji.js"),require("../../connectors/chains/base.js"),require("../../connectors/chains/baseSepolia.js"),require("../../connectors/chains/berachainArtio.js"),require("../../connectors/chains/celo.js"),require("../../connectors/chains/celoAlfajores.js"),require("../../connectors/chains/filecoin.js"),require("../../connectors/chains/filecoinCalibration.js"),require("../../connectors/chains/garnetHolesky.js"),require("../../connectors/chains/holesky.js"),require("../../connectors/chains/linea.js"),require("../../connectors/chains/lineaTestnet.js"),require("../../connectors/chains/lukso.js"),require("../../connectors/chains/mainnet.js"),require("../../connectors/chains/optimism.js"),require("../../connectors/chains/optimismSepolia.js"),require("../../connectors/chains/polygon.js"),require("../../connectors/chains/polygonAmoy.js"),require("../../connectors/chains/redstone.js"),require("../../connectors/chains/sepolia.js"),require("../../connectors/chains/zora.js"),require("../../connectors/chains/zoraSepolia.js"),require("../../connectors/chains/zoraTestnet.js"),require("../../connectors/chains/utils.js"),require("../../lib/solana/index.js"),require("../../theme.js"),require("tinycolor2"),require("../../lib/cybr53.js"),require("../../hooks/index.js"),require("../../auth-flows/siwe.js"),require("../../effect.js"),require("../../lib/siwe.js"),require("../../auth-flows/siws.js"),require("../../lib/siws.js"),require("../../components/Layouts.js"),require("../../components/ModalFooter.js"),require("../../svg/protected-by-privy.js"),require("../../components/ModalHeader.js"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../../connectors/errors.js"),require("@privy-io/js-sdk-core"),require("../../connectors/userAlreadyHasConnectedCoinbaseWallet.js"),require("../../connectors/walletconnect-v2.js"),require("@walletconnect/ethereum-provider"),require("../../svg/metamask.js"),require("../../connectors/ethereum/index.js"),require("viem/utils"),require("../../storage.js"),require("../../connectors/areWalletArraysEqual.js"),require("../../connectors/isBaseConnectedEthereumWallet.js"),require("../../connectors/base.js"),require("eventemitter3"),require("../../connectors/getRpcTimeout.js"),require("../../connectors/privyProxyProvider.js"),require("../../connectors/walletconnect-registry.js"),require("../../hook-utils/useInterval.js"),require("../../hooks/captcha-context.js"),require("../../hooks/modal-context.js"),require("../../components/PrefetchedImage.js"),require("../../screens/index.js"),require("../../hooks/privy-context.js"),require("../../lib/external-wallets/displayHelpers.js"),require("../../svg/backpack.js"),require("../../svg/brave-browser-icon.js"),require("../../svg/bybit.js"),require("../../svg/coinbase-wallet.js"),require("../../svg/cryptocom.js"),require("../../svg/okx-wallet.js"),require("../../svg/phantom.js"),require("../../svg/rabby.js"),require("../../svg/rainbow.js"),require("../../svg/safe.js"),require("../../svg/solflare.js"),require("../../svg/uniswap.js"),require("../../svg/universal-profile.js"),require("../../svg/zerion.js"),require("../../lib/useHasTabbedAway.js"),require("../../lib/user/shouldProceedtoEmbeddedWalletCreationFlow.js"),require("../../lib/user/shouldCreateEmbeddedEthWallet.js"),require("../../client/user.js"),require("../../lib/user/shouldCreateEmbeddedSolWallet.js"),require("../../svg/browser-extension-wallet-icon.js"),require("zustand"),require("zustand/shallow"),require("zustand/traditional");var k=/*#__PURE__*/C(i);let B=e=>e.chains.some((e=>e.startsWith("eip155:"))),W=e=>e.chains.some((e=>e.startsWith("solana:"))),I=/*#__PURE__*/s.styled.button.withConfig({displayName:"Button",componentId:"sc-ad1dbdbe-0"})(["gap:1rem;align-items:center;display:flex;width:100%;padding:1rem;border-radius:var(--privy-border-radius-lg);background:var(--privy-color-background-2);position:relative;text-align:left;font-weight:500;transition:background 200ms ease-in;svg{stroke-width:2.5;width:100%;max-height:1rem;max-width:1rem;flex-shrink:0;}&:hover{background:var(--privy-color-background-3);}"]),T=/*#__PURE__*/s.styled.span.withConfig({displayName:"ButtonBadge",componentId:"sc-ad1dbdbe-1"})(["display:flex;align-items:center;justify-content:end;margin-left:auto;position:relative;& > svg{border-radius:var(--privy-border-radius-full);}& > svg:not(:last-child){border-radius:var(--privy-border-radius-full);margin-right:-0.375rem;}"]),S=/*#__PURE__*/s.styled.div.withConfig({displayName:"ConnectContainer",componentId:"sc-ad1dbdbe-2"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;h3{margin-top:1.5rem;font-size:1rem;font-weight:500;line-height:1.5rem;}"]),_=/*#__PURE__*/s.styled.div.withConfig({displayName:"SearchDivider",componentId:"sc-ad1dbdbe-3"})(["width:100%;height:20px;background:radial-gradient(circle at bottom center,transparent 50%,white 100%);"]),L=/*#__PURE__*/s.styled.div.withConfig({displayName:"EmptyContainer",componentId:"sc-ad1dbdbe-4"})(["height:60px;display:flex;align-items:center;justify-content:center;text-align:center;"]);exports.default=({onBack:i,onClose:s})=>{let C=h.useAppConfig(),{connectors:E}=g.usePrivyInternal(),[A,P]=t.useState([]),[M,F]=t.useState(),[R,N]=t.useState(),[z,H]=t.useState(),[U,$]=t.useState(""),[O,D]=t.useState();t.useEffect((()=>{new j.WalletConnectClient(C.walletConnectCloudProjectId).fetchListings().then((e=>P(e.listings))).catch(console.error)}),[]);let G=E.filter((e=>"injected"===e.connectorType)),Q=E.filter((e=>"solana"===e.chainType)),X=G.map((e=>{let r=Q.find((r=>r.walletClientType.replace("_wallet","")===e.walletClientType.replace("_wallet","")));if(r)return{eth:e,sol:r}})).filter((e=>!!e)),Y=E.find((e=>"wallet_connect_v2"===e.connectorType)),V=E.find((e=>"coinbase_wallet"===e.connectorType)),J=async(e,r)=>{if(e){if(D("loading"),"string"==typeof e)return H({connector:e,name:r?.name??"Wallet",icon:r?.icon}),void window.open(e,"_blanlk");H({connector:e,name:r?.name??e?.walletBranding.name??"Wallet",icon:r?.icon??e?.walletBranding.icon});try{let r=await e.connect({showPrompt:!0});if(!r)return void D("error");D("success"),v.setActiveWallet({address:r.address,client:r.walletClientType,appId:C.id}),setTimeout((()=>{i()}),m.DEFAULT_SUCCESS_SCREEN_DURATION_MS)}catch(e){D("error")}}},K=!M&&!R&&!z,Z=t.useMemo((()=>z?.connector===Y&&R&&o.isMobile?`Go to ${z.name} to continue`:z?.connector===Y&&R?`Scan code to connect to ${z.name}`:"string"==typeof z?.connector?`Open or install ${z.name}`:M&&!z?"Select network":z?null:"Connect wallet"),[M,z,R]),ee=[...G,...Q,...X.map((e=>e.eth)),V,...A.map((e=>({walletBranding:e})))].filter((e=>e.walletBranding.name.toLowerCase().includes(U.toLowerCase())));/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsxs(b.Header,{children:[/*#__PURE__*/e.jsx(b.CloseButton,{onClick:()=>R?(D(void 0),H(void 0),void N(void 0)):z?(D(void 0),void H(void 0)):M?(D(void 0),H(void 0),void F(void 0)):"error"===O||"loading"===O?(D(void 0),void H(void 0)):void i(),children:/*#__PURE__*/e.jsx(k.default,{height:"1rem",width:"1rem",strokeWidth:1.5})}),/*#__PURE__*/e.jsx(b.CloseButton,{onClick:s,children:/*#__PURE__*/e.jsx(w.X,{})})]}),Z&&/*#__PURE__*/e.jsx(r.DialogTitle,{as:d.Title,style:{display:"block",width:"100%"},children:Z}),z&&!R&&"string"==typeof z.connector&&/*#__PURE__*/e.jsxs(u.Subtitle,{style:{textAlign:"center",display:"block"},children:["To connect to ",z.name,", install and open the app. Then confirm the connection when prompted."]}),K&&/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsxs(c.EmailUpdateForm,{style:{marginTop:"0.5rem",background:"transparent"},children:[/*#__PURE__*/e.jsx(n.MagnifyingGlassIcon,{}),/*#__PURE__*/e.jsx("input",{className:"login-method-button",type:"text",placeholder:"Search wallets",onChange:e=>$(e.target.value),value:U})]}),/*#__PURE__*/e.jsx(_,{})]}),/*#__PURE__*/e.jsxs(b.ScrollContainer,{$colorScheme:C.appearance.palette.colorScheme,style:{paddingTop:K?"0rem":"1.5rem",marginBottom:R?"0.5rem":void 0},children:[R&&/*#__PURE__*/e.jsxs(e.Fragment,{children:[o.isMobile?/*#__PURE__*/e.jsxs(S,{children:[z?.icon?/*#__PURE__*/e.jsx(p.WalletLoading,{walletLogo:z.icon,success:"success"===O,fail:"error"===O}):null,/*#__PURE__*/e.jsxs("h3",{children:["Waiting for ",z?.name??"connection"]})]}):/*#__PURE__*/e.jsx(l.QrCode,{size:280,url:R.universal??R.native,squareLogoElement:z?.icon?"string"==typeof z.icon?r=>/*#__PURE__*/e.jsx("svg",{...r,children:/*#__PURE__*/e.jsx("image",{href:z.icon,height:r.height,width:r.width})}):z.icon:q.WalletConnect}),o.isMobile&&"loading"===O&&/*#__PURE__*/e.jsx(a.PrimaryButton,{style:{marginTop:"0.5rem"},onClick:()=>window.open(R.universal??R.native,"_blank"),children:"Open in app"})]}),z&&!R&&"string"!=typeof z.connector&&/*#__PURE__*/e.jsxs(S,{children:[z.icon?/*#__PURE__*/e.jsx(p.WalletLoading,{walletLogo:z.icon,success:"success"===O,fail:"error"===O}):null,/*#__PURE__*/e.jsxs("h3",{children:["Waiting for ",z.name]}),/*#__PURE__*/e.jsx(u.Subtitle,{children:"error"===O?"Please try connecting again.":"For the best experience, connect only one wallet at a time."}),"error"===O&&/*#__PURE__*/e.jsx(a.PrimaryButton,{style:{marginTop:"1.5rem"},onClick:()=>J(z.connector,{name:z.name,icon:z.icon}),children:"Retry"})]}),z&&!R&&"string"==typeof z.connector&&/*#__PURE__*/e.jsx(e.Fragment,{children:/*#__PURE__*/e.jsxs(I,{onClick:()=>window.open(z.connector,"_blank"),children:[z.icon&&("string"==typeof z.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:z.icon}):/*#__PURE__*/e.jsx(z.icon,{})),z.name]})}),M?.eth&&!z&&/*#__PURE__*/e.jsxs(I,{onClick:()=>J(M.eth,{name:M.name,icon:M.icon}),children:[M.icon&&("string"==typeof M.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:M.icon}):/*#__PURE__*/e.jsx(M.icon,{})),M.name,/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(x.default,{})})]}),M?.sol&&!z&&/*#__PURE__*/e.jsxs(I,{onClick:()=>J(M.sol,{name:M.name,icon:M.icon}),children:[M.icon&&("string"==typeof M.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:M.icon}):/*#__PURE__*/e.jsx(M.icon,{})),M.name,/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(y.default,{})})]}),K&&/*#__PURE__*/e.jsxs(e.Fragment,{children:[!ee.length&&/*#__PURE__*/e.jsx(L,{children:"No wallets found. Try another search."}),G.filter((e=>!X.some((r=>e===r.eth)))).filter((e=>e.walletBranding.name.toLowerCase().includes(U.toLowerCase()))).map(((r,n)=>/*#__PURE__*/e.jsxs(I,{onClick:()=>J(r),children:[/*#__PURE__*/e.jsx(b.WalletIconContainer,{children:r.walletBranding.icon&&("string"==typeof r.walletBranding.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:r.walletBranding.icon}):/*#__PURE__*/e.jsx(r.walletBranding.icon,{}))}),r.walletBranding.name,/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(x.default,{})})]},n))),X.filter((e=>e.eth.walletBranding.name.toLowerCase().includes(U.toLowerCase()))).map(((r,n)=>/*#__PURE__*/e.jsxs(I,{onClick:()=>{F({eth:r.eth,sol:r.sol,name:r.eth.walletBranding.name,icon:r.eth.walletBranding.icon})},children:[/*#__PURE__*/e.jsx(b.WalletIconContainer,{children:r.eth.walletBranding.icon&&("string"==typeof r.eth.walletBranding.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:r.eth.walletBranding.icon}):/*#__PURE__*/e.jsx(r.eth.walletBranding.icon,{}))}),r.eth.walletBranding.name,/*#__PURE__*/e.jsxs(T,{children:[/*#__PURE__*/e.jsx(x.default,{}),/*#__PURE__*/e.jsx(y.default,{})]})]},n))),Q.filter((e=>!X.some((r=>e===r.sol)))).filter((e=>e.walletBranding.name.toLowerCase().includes(U.toLowerCase()))).map(((r,n)=>/*#__PURE__*/e.jsxs(I,{onClick:()=>J(r),children:[/*#__PURE__*/e.jsx(b.WalletIconContainer,{children:r.walletBranding.icon&&("string"==typeof r.walletBranding.icon?/*#__PURE__*/e.jsx(b.WalletIcon,{src:r.walletBranding.icon}):/*#__PURE__*/e.jsx(r.walletBranding.icon,{}))}),r.walletBranding.name,/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(y.default,{})})]},n))),V&&("coinbase wallet".includes(U.toLowerCase())||"coinbase smart wallet".includes(U.toLowerCase()))&&!G.find((e=>"coinbase_wallet"===e.walletClientType||"coinbase_smart_wallet"===e.walletClientType))&&/*#__PURE__*/e.jsxs(I,{onClick:()=>J(V),children:[V.walletBranding.icon&&/*#__PURE__*/e.jsx(b.WalletIcon,{src:V.walletBranding.icon}),V.walletBranding.name,/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(x.default,{})})]}),A.filter((e=>!(G.find((r=>r.walletClientType.replace("_wallet","")===e.slug.replace("-wallet","")))||Q.find((r=>r.walletClientType.replace("_wallet","")===e.slug.replace("-wallet","")))||V&&"coinbase-wallet"===e.slug))).filter((e=>e.name.toLowerCase().includes(U.toLowerCase()))).map(((r,n)=>{let i=W(r),t=B(r);return t||i?/*#__PURE__*/e.jsxs(I,{onClick:async()=>{let e=f.WC_REGISTRY_PATCH[r.slug]?.mobile.native??r.mobile.native,n=f.WC_REGISTRY_PATCH[r.slug]?.mobile.universal??r.mobile.universal;Y.setWalletEntry({id:r.id,displayName:r.name,imageUrl:r.image_url?.sm,mobile:{native:e,universal:n},hostname:"deprecated",isWalletEntryOverriden:!0},N),await Y.resetConnection(r.slug);let o=n||e,s=o?`${o}browse/${encodeURIComponent(window.location.href)}?ref=${encodeURIComponent(window.location.href)}`:r.homepage;i&&t?F({eth:Y,sol:s,name:r.name,icon:r.image_url?.sm}):i?await J(s,{name:r.name,icon:r.image_url?.sm}):await J(Y,{name:r.name,icon:r.image_url?.sm})},children:[r.image_url&&/*#__PURE__*/e.jsx(b.WalletIcon,{src:r.image_url.sm}),r.name,/*#__PURE__*/e.jsxs(T,{children:[t&&/*#__PURE__*/e.jsx(x.default,{}),i&&/*#__PURE__*/e.jsx(y.default,{})]})]},n):null}))]})]})]})};
