"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/solid/XCircleIcon"),n=require("react"),o=require("styled-components"),i=require("../client/user.js"),t=require("../components/Button.js"),s=require("../components/Layouts.js"),c=require("../components/ModalHeader.js"),a=require("../components/ScreenHeader.js"),l=require("../components/primitives/LoadingSpinner/index.js"),u=require("../configuration/context.js"),d=require("../effect.js"),h=require("../errors.js"),j=require("../hooks/internal-context.js"),q=require("../hooks/modal-context.js"),m=require("../hooks/privy-context.js"),y=require("../hooks/useEmbeddedWalletCreate.js"),E=require("../lib/embeddedWalletRecovery.js"),p=require("../lib/user/shouldCreateEmbeddedEthWallet.js"),f=require("../lib/user/shouldCreateEmbeddedSolWallet.js"),v=require("./index.js");function S(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("viem/utils"),require("../components/Loader.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../constants.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../hooks/index.js"),require("ofetch"),require("../components/PrefetchedImage.js"),require("../paths.js"),require("../lib/pkce.js"),require("jose"),require("../crypto.js"),require("../storage.js");var g=/*#__PURE__*/S(r);let C=/*#__PURE__*/o.styled.div.withConfig({displayName:"BottomSpacing",componentId:"sc-f34e977e-0"})(["height:44px;"]);exports.EmbeddedWalletOnAccountCreateScreen=()=>{let{app:r,setModalData:o,navigate:S,data:b,onUserCloseViaDialogOrKeybindRef:w}=q.usePrivyModal(),[A,W]=n.useState(""),{embeddedWallets:x}=u.useAppConfig(),{authenticated:D,user:M,getAccessToken:P}=m.usePrivyContext(),{closePrivyModal:R,walletProxy:k,refreshSessionAndUser:L,recoverPrimaryWallet:I}=j.usePrivyInternal(),{onSuccess:T,onFailure:O,callAuthOnSuccessOnClose:_}=b.createWallet,B=!0===r?.embeddedWallets.requireUserOwnedRecoveryOnCreate,{createWallet:F}=y.useCreateWallet(),[N,H]=n.useState(null),U=new d.RunEffectOnce((async()=>{let e=await P();if(M&&e&&k)try{let n=i.getPrivyPrimaryWallet(M);if(n&&"privy"===n.recoveryMethod)await I();else if(n){let{entropyId:r,entropyIdVerifier:o}=i.getEntropyDetailsFromAccount(n);try{if(!await k.connect({accessToken:e,entropyId:r,entropyIdVerifier:o}))throw new h.PrivyClientError("Primary wallet not connected.")}catch(e){return H(n),void S(v.ModalScreen.EMBEDDED_WALLET_CREATED_SCREEN)}}let o=p.shouldCreateEmbeddedEthWallet(M,r.embeddedWallets.ethereum.createOnLogin),t=f.shouldCreateEmbeddedSolWallet(M,r.embeddedWallets.solana.createOnLogin);if(o&&t){let r=await F({user:M});if(await k.createSolana({accessToken:e,ethereumAddress:r?.address}),!r)return;return H(r),void S(v.ModalScreen.EMBEDDED_WALLET_CREATED_SCREEN)}if(t){await k.createSolana({accessToken:e,ethereumAddress:i.getPrivyEthereumWallet(M)?.address});let r=await L();return H(i.getPrivySolanaWallet(r)),void S(v.ModalScreen.EMBEDDED_WALLET_CREATED_SCREEN)}if(o){let e=await F({user:M});if(!e)return;H(e),S(v.ModalScreen.EMBEDDED_WALLET_CREATED_SCREEN)}}catch(e){W(e.message)}}));return n.useEffect((()=>D&&M?B?(o({...b,recoverySelection:{...b?.recoverySelection,isInAccountCreateFlow:!0}}),S(E.toEmbeddedWalletSetRecoveryScreen({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:x.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void U.execute():(S(v.ModalScreen.LANDING),void O(Error("User must be authenticated before creating a Privy wallet")))),[B,D]),w.current=()=>null,A?/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(c.ModalHeader,{closeable:!1}),/*#__PURE__*/e.jsxs(s.CenteredItemWithGap,{children:[/*#__PURE__*/e.jsx(g.default,{fill:"var(--privy-color-error)",width:"64px",height:"64px"}),/*#__PURE__*/e.jsx(a.CenteredScreenHeader,{title:"Something went wrong",description:A})]}),/*#__PURE__*/e.jsx(t.PrimaryButton,{onClick:()=>{N?(T(N),R({shouldCallAuthOnSuccess:_})):(O(new h.PrivyEmbeddedWalletError("User wallet creation failed")),R({shouldCallAuthOnSuccess:!1}))},children:"Close"}),/*#__PURE__*/e.jsx(C,{})]}):/*#__PURE__*/e.jsx(l.FullScreenLoadingSpinner,{})};
