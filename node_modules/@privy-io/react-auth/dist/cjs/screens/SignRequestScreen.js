"use strict";var e=require("react/jsx-runtime"),r=require("react"),i=require("styled-components"),o=require("viem"),n=require("@privy-io/js-sdk-core"),s=require("../components/Button.js"),t=require("../components/CopyToClipboard.js"),c=require("../components/Layouts.js"),a=require("../components/ModalFooter.js"),l=require("../components/ModalHeader.js"),u=require("../components/embedded-wallets/StyledLogo.js"),d=require("../components/primitives/JsonTree.js"),p=require("../components/ui/typography/Subtitle.js"),h=require("../components/ui/typography/Title.js"),j=require("../connectors/errors.js"),q=require("../constants.js"),y=require("../hooks/internal-context.js"),g=require("../hooks/modal-context.js"),m=require("../hooks/privy-context.js"),x=require("../svg/checkmark.js"),f=require("./index.js");require("../components/Loader.js"),require("../svg/copy.js"),require("../configuration/context.js"),require("../config.js"),require("../configuration/defaultClientConfig.js"),require("../configuration/login-methods.js"),require("../configuration/wallets.js"),require("../connectors/chains/index.js"),require("../connectors/chains/arbitrum.js"),require("../connectors/chains/arbitrumSepolia.js"),require("../connectors/chains/avalanche.js"),require("../connectors/chains/avalancheFuji.js"),require("../connectors/chains/base.js"),require("../connectors/chains/baseSepolia.js"),require("../connectors/chains/berachainArtio.js"),require("../connectors/chains/celo.js"),require("../connectors/chains/celoAlfajores.js"),require("../connectors/chains/filecoin.js"),require("../connectors/chains/filecoinCalibration.js"),require("../connectors/chains/garnetHolesky.js"),require("../connectors/chains/holesky.js"),require("../connectors/chains/linea.js"),require("../connectors/chains/lineaTestnet.js"),require("../connectors/chains/lukso.js"),require("../connectors/chains/mainnet.js"),require("../connectors/chains/optimism.js"),require("../connectors/chains/optimismSepolia.js"),require("../connectors/chains/polygon.js"),require("../connectors/chains/polygonAmoy.js"),require("../connectors/chains/redstone.js"),require("../connectors/chains/sepolia.js"),require("../connectors/chains/zora.js"),require("../connectors/chains/zoraSepolia.js"),require("../connectors/chains/zoraTestnet.js"),require("../connectors/chains/utils.js"),require("../lib/solana/index.js"),require("../theme.js"),require("tinycolor2"),require("../lib/cybr53.js"),require("../svg/protected-by-privy.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("../hooks/index.js"),require("../errors.js"),require("ofetch"),require("../components/PrefetchedImage.js");let v=e=>{if(!o.isHex(e))return e;try{return o.hexToString(e)}catch{return e}},S=r=>{let{types:i,primaryType:o,...n}=r.typedData;/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(d.DisplayJsonTree,{data:n}),/*#__PURE__*/e.jsx(t.CopytoClipboardButton,{text:(s=r.typedData,JSON.stringify(s,null,2)),itemName:"full payload to clipboard"})," "]});var s};let E=/*#__PURE__*/i.styled.div.withConfig({displayName:"InputHelp",componentId:"sc-cc107211-0"})(["line-height:20px;height:20px;font-size:13px;color:",";display:flex;justify-content:flex-start;width:100%;margin-top:16px;margin-bottom:4px;"],(e=>e.$fail?"var(--privy-color-error)":"var(--privy-color-foreground-3)")),C=/*#__PURE__*/i.styled.span.withConfig({displayName:"ContentWithIcon",componentId:"sc-cc107211-1"})(["display:flex;align-items:center;gap:8px;"]),T=/*#__PURE__*/i.styled.div.withConfig({displayName:"IconContainer",componentId:"sc-cc107211-2"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:82px;"]),b=/*#__PURE__*/i.styled.div.withConfig({displayName:"Grow",componentId:"sc-cc107211-3"})(["flex-grow:1;"]);exports.SignRequestScreen=()=>{let{authenticated:i}=m.usePrivyContext(),{initializeWalletProxy:o,closePrivyModal:t}=y.usePrivyInternal(),{navigate:R,data:w,onUserCloseViaDialogOrKeybindRef:P}=g.usePrivyModal(),[_,I]=r.useState(!0),[k,A]=r.useState(""),[N,M]=r.useState(),[L,D]=r.useState(null),[U,F]=r.useState(!1),O=null!==L;r.useEffect((()=>{i||R(f.ModalScreen.LANDING)}),[i]),r.useEffect((()=>{o(q.WALLET_PROXY_TIMEOUT).then((e=>{I(!1),e||(A("An error has occurred, please try again."),M(new j.PrivyProviderRpcError(new j.ProviderRpcError(k,n.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:z,data:B,confirmAndSign:H,onSuccess:W,onFailure:J,uiOptions:G}=w.signMessage,Q={title:G.title||"Sign message",description:G.description||"Signing this message will not cost you any fees.",buttonText:G.buttonText||"Sign and continue"},X=e=>{e?W(e):J(N||new j.PrivyProviderRpcError(new j.ProviderRpcError("The user rejected the request.",n.ProviderErrors.E4001_USER_REJECTED_REQUEST.eipCode))),t({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{D(null),A(""),M(void 0)}),200)};return P.current=()=>{X(L)},/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(l.ModalHeader,{onClose:()=>X(L)}),/*#__PURE__*/e.jsx(c.RefactorSpacerTop,{}),G.iconUrl&&"string"==typeof G.iconUrl?/*#__PURE__*/e.jsx(T,{children:/*#__PURE__*/e.jsx(u.StyledLogo,{size:"sm",src:G.iconUrl,alt:"app image"})}):null,/*#__PURE__*/e.jsx(h.Title,{children:Q.title}),/*#__PURE__*/e.jsx(p.Subtitle,{children:Q.description}),"personal_sign"===z&&/*#__PURE__*/e.jsx(d.Message,{children:v(B)}),"eth_signTypedData_v4"===z&&/*#__PURE__*/e.jsx(S,{typedData:B}),"solana_signMessage"===z&&/*#__PURE__*/e.jsx(d.Message,{children:B}),/*#__PURE__*/e.jsx(b,{}),/*#__PURE__*/e.jsx(E,{$fail:!0,children:k}),/*#__PURE__*/e.jsx(s.PrimaryButtonWithoutGray,{disabled:U||O||_,loading:U,onClick:async()=>{F(!0),A("");try{let e=await H();D(e),F(!1),setTimeout((()=>{X(e)}),q.DEFAULT_SUCCESS_SCREEN_DURATION_MS)}catch(e){console.error(e),A("An error has occurred, please try again."),M(new j.PrivyProviderRpcError(new j.ProviderRpcError(k,n.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),F(!1)}},children:U?"Signing...":O?/*#__PURE__*/e.jsxs(C,{children:[/*#__PURE__*/e.jsx(x.Checkmark,{style:{height:"0.9rem",width:"0.9rem"},strokeWidth:2})," ",/*#__PURE__*/e.jsx("span",{children:"Success"})]}):Q.buttonText}),G.isCancellable&&/*#__PURE__*/e.jsx(s.EmbeddedButton,{style:{marginTop:"1rem"},onClick:()=>X(null),isSubmitting:!1,children:"Not now"}),/*#__PURE__*/e.jsx(c.RefactorSpacerBottom,{}),/*#__PURE__*/e.jsx(a.BlobbyFooter,{})]})};
